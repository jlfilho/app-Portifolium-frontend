<div class="courses-container">
  <!-- Header com título e botão adicionar -->
  <div class="courses-header">
    <h2>Meus Cursos</h2>
    <span class="space"></span>
    <button
      mat-icon-button
      class="add-button"
      matTooltip="Adicionar novo curso"
      matTooltipPosition="below"
      (click)="addCourse()">
      <mat-icon>add</mat-icon>
    </button>
  </div>

  <mat-divider></mat-divider>

  <!-- Filtros -->
  <div class="filters-section">
    <h3 class="filters-title">
      <mat-icon>filter_list</mat-icon>
      Filtros
    </h3>

    <div class="filters-grid">
      <!-- Filtro por Nome -->
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Buscar por nome</mat-label>
        <input
          matInput
          [(ngModel)]="filtroNome"
          (ngModelChange)="onSearchChange($event)"
          placeholder="Digite parte do nome...">
        <mat-icon matPrefix>search</mat-icon>
        <button
          mat-icon-button
          matSuffix
          *ngIf="filtroNome"
          (click)="filtroNome = ''; onSearchChange('')"
          matTooltip="Limpar busca">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>

      <!-- Filtro por Status -->
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Status do Curso</mat-label>
        <mat-select
          [(ngModel)]="filtroStatus"
          (ngModelChange)="onStatusChange()">
          <mat-option *ngFor="let status of statusOptions" [value]="status.value">
            {{ status.label }}
          </mat-option>
        </mat-select>
        <mat-icon matPrefix>toggle_on</mat-icon>
      </mat-form-field>

      <!-- Botão Limpar Filtros -->
      <button
        mat-stroked-button
        (click)="limparFiltros()"
        [disabled]="isLoading || (!filtroNome && filtroStatus === null)"
        class="btn-clear-filters">
        <mat-icon>clear_all</mat-icon>
        Limpar Filtros
      </button>
    </div>

    <!-- Filtros ativos -->
    <div class="active-filters" *ngIf="filtroNome || filtroStatus !== null">
      <span class="filters-label">Filtros ativos:</span>
      <mat-chip-set>
        <mat-chip *ngIf="filtroNome" class="filter-chip">
          <mat-icon matChipAvatar>search</mat-icon>
          Nome: "{{ filtroNome }}"
          <button matChipRemove (click)="filtroNome = ''; onSearchChange('')">
            <mat-icon>cancel</mat-icon>
          </button>
        </mat-chip>
        <mat-chip *ngIf="filtroStatus !== null" class="filter-chip">
          <mat-icon matChipAvatar>toggle_on</mat-icon>
          {{ filtroStatus ? 'Ativos' : 'Inativos' }}
          <button matChipRemove (click)="filtroStatus = null; onStatusChange()">
            <mat-icon>cancel</mat-icon>
          </button>
        </mat-chip>
      </mat-chip-set>
    </div>
  </div>

  <mat-divider></mat-divider>

  <!-- Stats row -->
  <div class="stats-row" *ngIf="!isLoading && cursos.length > 0">
    <span>Total de cursos: <strong>{{ totalElements }}</strong></span>
    <span>Exibindo: <strong>{{ cursos.length }}</strong> de <strong>{{ totalElements }}</strong></span>
  </div>

  <!-- Mensagem de erro -->
  <div *ngIf="errorMessage" class="error">
    {{ errorMessage }}
  </div>

  <!-- Loading -->
  <div class="loading" *ngIf="isLoading">
    <mat-progress-spinner mode="indeterminate" diameter="48"></mat-progress-spinner>
    <span>Carregando cursos...</span>
  </div>

  <!-- Grid de cursos -->
  @if (!isLoading && cursos.length > 0) {
    <mat-grid-list
      cols="3"
      rowHeight="420px"
      gutterSize="24px"
      class="grid-list"
      [cols]="getColumns()">
      @for (curso of cursos; track curso.id) {
        <mat-grid-tile>
          <mat-card class="card" appearance="outlined" [class.card-inactive]="!curso.ativo">
            <!-- Header do Card -->
            <mat-card-header class="card-header">
              <div mat-card-avatar class="header-image"></div>
              <mat-card-title>{{ curso.nome }}</mat-card-title>
              <button
                mat-icon-button
                class="edit-button"
                matTooltip="Editar curso"
                matTooltipPosition="left"
                (click)="editCourse(curso.id); $event.stopPropagation()">
                <mat-icon>edit</mat-icon>
              </button>
            </mat-card-header>

            <!-- Imagem do Curso -->
            <img
              class="card-image"
              mat-card-image
              ngSrc="/imagens/curso-header.png"
              alt="Imagem do curso {{ curso.nome }}"
              width="398"
              height="318"
              priority
            />

            <!-- Ações do Card -->
            <mat-card-actions>
              <button
                mat-icon-button
                matTooltip="Gerenciar atividades"
                matTooltipPosition="above"
                (click)="manageAtividades(curso); $event.stopPropagation()">
                <mat-icon>hub</mat-icon>
              </button>

              <button
                mat-icon-button
                matTooltip="Gerenciar permissões"
                matTooltipPosition="above"
                (click)="managePermissions(curso); $event.stopPropagation()">
                <mat-icon>manage_accounts</mat-icon>
              </button>

              <button
                mat-icon-button
                [matTooltip]="curso.ativo ? 'Desativar curso' : 'Ativar curso'"
                matTooltipPosition="above"
                [class.status-active]="curso.ativo"
                [class.status-inactive]="!curso.ativo"
                (click)="toggleCourseStatus(curso); $event.stopPropagation()">
                <mat-icon>{{ curso.ativo ? 'visibility' : 'visibility_off' }}</mat-icon>
              </button>

              <button
                mat-icon-button
                matTooltip="Excluir curso"
                matTooltipPosition="above"
                (click)="deleteCourse(curso); $event.stopPropagation()">
                <mat-icon>delete</mat-icon>
              </button>
            </mat-card-actions>
          </mat-card>
        </mat-grid-tile>
      }
    </mat-grid-list>

    <!-- Paginação -->
    <mat-paginator
      [length]="totalElements"
      [pageSize]="pageSize"
      [pageIndex]="pageIndex"
      [pageSizeOptions]="pageSizeOptions"
      (page)="onPageChange($event)"
      showFirstLastButtons
      class="paginator">
    </mat-paginator>
  } @else if (!isLoading) {
    <!-- Mensagem quando não há cursos -->
    <div class="empty-state">
      <mat-icon class="empty-icon">school</mat-icon>
      <p>Você não possui cursos cadastrados.</p>
      <button mat-raised-button color="primary" (click)="addCourse()">
        <mat-icon>add</mat-icon>
        Adicionar Primeiro Curso
      </button>
    </div>
  }
</div>
